# ADR-001: 技术栈选择

## 状态
已接受

## 上下文

数字银行POC系统需要在14天内完成开发，需要选择成熟、稳定、高效的技术栈，同时支持AI Agent自动化开发。技术栈选择需要考虑：
- 开发效率：支持快速开发和自动化代码生成
- 生态成熟度：丰富的工具链和社区支持
- 性能要求：支持100 TPS并发，响应时间P95<2s
- 可维护性：代码结构清晰，易于测试和维护
- AI Agent友好：支持自动化代码生成和测试

## 考虑的选项

### 选项1: 统一技术栈（单一语言）
- **后端**: 全部使用Java + Spring Boot
- **数据库**: 全部使用PostgreSQL
- **前端**: React + TypeScript

### 选项2: 混合技术栈（按场景选择）
- **核心服务**: Java + Spring Boot + PostgreSQL（强事务）
- **支付服务**: Node.js + Express + MongoDB（高并发）
- **风控服务**: Python + FastAPI + Elasticsearch（数据分析）
- **前端**: React + TypeScript

### 选项3: 云原生技术栈
- **后端**: Go + gRPC
- **数据库**: 云数据库服务
- **前端**: Vue.js + TypeScript

## 选项比较

| 评估维度 | 选项1: 统一技术栈 | 选项2: 混合技术栈 | 选项3: 云原生 |
|---------|------------------|------------------|--------------|
| **开发效率** | ⭐⭐⭐⭐ 统一技术栈，学习成本低 | ⭐⭐⭐⭐⭐ 各服务使用最适合的技术 | ⭐⭐⭐ 需要学习新语言和框架 |
| **性能** | ⭐⭐⭐⭐ 满足要求 | ⭐⭐⭐⭐⭐ 各服务性能最优 | ⭐⭐⭐⭐⭐ 云原生性能优秀 |
| **生态成熟度** | ⭐⭐⭐⭐⭐ Java生态非常成熟 | ⭐⭐⭐⭐⭐ 各技术栈生态都成熟 | ⭐⭐⭐ 相对较新 |
| **AI Agent友好** | ⭐⭐⭐⭐ 统一模式，易于自动化 | ⭐⭐⭐⭐⭐ 各技术栈都有丰富工具 | ⭐⭐⭐ 工具链相对较少 |
| **运维复杂度** | ⭐⭐⭐⭐⭐ 统一部署和监控 | ⭐⭐⭐ 需要管理多种技术栈 | ⭐⭐⭐⭐ 云原生工具完善 |
| **14天交付可行性** | ⭐⭐⭐⭐ 可行 | ⭐⭐⭐⭐⭐ 最可行 | ⭐⭐ 学习成本高，风险大 |
| **可扩展性** | ⭐⭐⭐⭐ 良好 | ⭐⭐⭐⭐⭐ 各服务独立扩展 | ⭐⭐⭐⭐⭐ 云原生扩展性强 |

### 详细分析

#### 选项1: 统一技术栈
**优点**:
- 团队只需熟悉一种技术栈
- 代码风格统一，易于维护
- 部署和监控方案统一
- 学习成本低

**缺点**:
- 无法针对不同场景选择最优技术
- Node.js的异步特性更适合支付高并发场景
- Python的机器学习库更适合风控场景
- 可能无法充分发挥各场景的优势

#### 选项2: 混合技术栈（推荐）
**优点**:
- 每个服务使用最适合的技术栈
- Java适合核心银行服务的强事务需求
- Node.js适合支付服务的高并发需求
- Python适合风控服务的数据分析需求
- 各技术栈生态成熟，工具丰富
- AI Agent可以针对不同技术栈使用专门工具

**缺点**:
- 需要管理多种技术栈
- 运维复杂度增加
- 团队需要熟悉多种技术

**风险缓解**:
- 统一API规范（OpenAPI 3.0）
- 统一容器化部署（Docker + Kubernetes）
- 统一监控方案（Prometheus + Grafana）

#### 选项3: 云原生技术栈
**优点**:
- 云原生架构，扩展性强
- Go语言性能优秀
- gRPC通信效率高

**缺点**:
- 学习成本高（需要学习Go语言）
- 14天交付时间紧张，风险大
- 工具链相对较少，AI Agent支持不足
- 不符合快速交付的要求

## 决策

经过项目启动会议讨论和技术评估，我们决定采用**选项2: 混合技术栈**。

**选择理由**:
1. **14天交付可行性最高**: 各技术栈生态成熟，工具丰富，AI Agent可以快速上手
2. **性能最优**: 每个服务使用最适合的技术栈，充分发挥各技术优势
3. **AI Agent友好**: 各技术栈都有丰富的自动化工具和代码生成能力
4. **风险可控**: 虽然需要管理多种技术栈，但通过统一API规范、容器化部署和监控方案可以缓解

具体技术栈选择如下：

### 后端服务

#### Agent 1: 核心银行服务引擎
- **语言**: Java 17
- **框架**: Spring Boot 3.x
- **数据库**: PostgreSQL 15
- **ORM**: Spring Data JPA
- **测试**: JUnit 5, Mockito, TestContainers
- **API文档**: OpenAPI 3.0

**选择理由**:
- Spring Boot生态成熟，支持快速开发
- Spring Data JPA支持自动化代码生成
- PostgreSQL提供ACID事务保证，适合金融场景
- TestContainers支持集成测试自动化

#### Agent 2: 支付清算处理器
- **语言**: Node.js 20
- **框架**: Express.js
- **数据库**: MongoDB 7.0
- **ORM**: Mongoose
- **测试**: Jest, Supertest
- **任务队列**: Bull/Agenda
- **API文档**: OpenAPI 3.0

**选择理由**:
- Node.js异步特性适合支付场景的高并发需求
- MongoDB灵活的数据模型适合支付交易数据
- Express.js轻量级，开发效率高
- Bull支持异步任务处理

#### Agent 3: 风控合规守护者
- **语言**: Python 3.11
- **框架**: FastAPI
- **搜索引擎**: Elasticsearch 8.x
- **测试**: pytest
- **数据验证**: Pydantic
- **API文档**: OpenAPI 3.0

**选择理由**:
- Python丰富的机器学习库，便于未来扩展风控算法
- FastAPI自动生成OpenAPI文档，支持API测试自动化
- Elasticsearch强大的搜索和分析能力，适合风控场景
- Pydantic提供数据验证和序列化

### 前端

#### Agent 4: 前端体验构建器
- **框架**: React 18
- **语言**: TypeScript 5.x
- **样式**: Tailwind CSS 3.x
- **路由**: React Router v6
- **状态管理**: Context API / Redux Toolkit
- **HTTP客户端**: Axios
- **测试**: Jest, React Testing Library, Cypress
- **构建工具**: Vite

**选择理由**:
- React生态成熟，组件化开发效率高
- TypeScript提供类型安全，减少错误
- Tailwind CSS支持快速UI开发
- Vite提供快速的开发体验

### 基础设施

#### Agent 5: 应用基础设施层
- **API网关**: Kong
- **服务注册**: Consul
- **反向代理**: Nginx
- **容器编排**: Kubernetes
- **基础设施即代码**: Terraform
- **配置格式**: YAML, JSON

**选择理由**:
- Kong提供强大的API网关功能
- Consul支持服务发现和配置管理
- Kubernetes提供容器编排能力
- Terraform支持基础设施自动化

### 测试

#### Agent 6: 测试执行自动机
- **API测试**: Postman/Newman
- **E2E测试**: Cypress
- **性能测试**: JMeter
- **测试管理**: TestRail
- **测试数据**: Faker.js / Python Faker

**选择理由**:
- Postman支持API测试自动化
- Cypress提供强大的E2E测试能力
- JMeter支持性能测试
- Faker支持测试数据自动生成

### 安全

#### Agent 7: 安全扫描卫士
- **代码扫描**: SonarQube
- **安全扫描**: OWASP ZAP
- **依赖扫描**: Snyk / Dependabot
- **密钥管理**: HashiCorp Vault
- **安全标准**: OWASP Top 10

**选择理由**:
- SonarQube提供全面的代码质量检查
- OWASP ZAP支持自动化安全扫描
- Vault提供安全的密钥管理

### 运维

#### Agent 8: 运维自动化引擎
- **容器编排**: Kubernetes
- **基础设施**: Terraform
- **CI/CD**: GitLab CI
- **监控**: Prometheus
- **可视化**: Grafana
- **容器**: Docker
- **日志**: ELK Stack (可选)

**选择理由**:
- Kubernetes提供强大的容器编排能力
- Terraform支持基础设施即代码
- Prometheus + Grafana提供完整的监控方案

### 数据

#### Agent 9: 数据处理分析师
- **关系数据库**: PostgreSQL 15
- **文档数据库**: MongoDB 7.0
- **缓存**: Redis
- **数据迁移**: Flyway
- **测试数据**: Python Faker, Faker.js
- **数据分析**: Pandas
- **数据质量**: Great Expectations (可选)

**选择理由**:
- PostgreSQL和MongoDB满足不同数据存储需求
- Redis提供高性能缓存
- Flyway支持数据库版本管理
- Faker支持测试数据自动生成

## 后果

### 正面影响

1. **开发效率高**: 各技术栈都支持自动化代码生成和测试
2. **生态成熟**: 所有技术栈都有丰富的工具链和社区支持
3. **性能满足要求**: 技术栈组合能够满足100 TPS和P95<2s的性能要求
4. **易于维护**: 代码结构清晰，测试覆盖率高
5. **AI Agent友好**: 支持自动化开发，减少人工干预

### 负面影响

1. **技术栈多样性**: 需要团队熟悉多种技术栈（Java, Node.js, Python, React）
2. **运维复杂度**: 需要管理多个技术栈的部署和监控
3. **学习成本**: 新成员需要学习多种技术栈

### 风险缓解

1. **统一API规范**: 使用OpenAPI 3.0统一API接口规范
2. **容器化部署**: 使用Docker和Kubernetes统一部署方式
3. **自动化测试**: 全面的自动化测试减少人工错误
4. **文档完善**: 完善的技术文档和代码注释

## 日期
2026-01-26

## 相关文档
- 项目计划: `digital_bank_poc_plan.md`
- 技术标准规范: `docs/architecture/technical-standards-v1.0.md`
