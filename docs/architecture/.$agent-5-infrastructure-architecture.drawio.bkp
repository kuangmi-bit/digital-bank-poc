<mxfile host="app.diagrams.net">
  <diagram id="agent5-infrastructure" name="Agent 5 - 基础设施架构图">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- 标题 -->
        <mxCell id="title" value="Agent 5: 应用基础设施层架构图" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="600" height="40" as="geometry" />
        </mxCell>
        
        <!-- 客户端层 -->
        <mxCell id="client-container" value="客户端层" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="1300" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="web-client" value="Web浏览器&#xa;(React前端)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="mobile-client" value="移动应用&#xa;(iOS/Android)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="api-client" value="第三方API客户端" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="500" y="120" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- Nginx反向代理层 -->
        <mxCell id="nginx-container" value="Nginx反向代理层 (Agent 5管理)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="50" y="240" width="1300" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="nginx-1" value="Nginx实例 1&#xa;端口: 80/443&#xa;负载均衡: least_conn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="150" y="280" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="nginx-2" value="Nginx实例 2&#xa;端口: 80/443&#xa;负载均衡: least_conn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="400" y="280" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="nginx-features" value="功能:&#xa;• 反向代理&#xa;• 负载均衡&#xa;• SSL终止&#xa;• 健康检查&#xa;• Gzip压缩" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="650" y="280" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Kong API Gateway层 -->
        <mxCell id="kong-container" value="Kong API Gateway层 (Agent 5管理)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="50" y="420" width="1300" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="kong-gateway" value="Kong API Gateway&#xa;端口: 8000 (代理)&#xa;端口: 8001 (管理)&#xa;模式: DB-less" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#0066cc;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="150" y="460" width="200" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="kong-routes" value="路由规则 (9条):&#xa;• /api/v1/accounts → core-bank&#xa;• /api/v1/customers → core-bank&#xa;• /api/v1/transactions → core-bank&#xa;• /api/v1/payments → payment&#xa;• /api/v1/settlements → payment&#xa;• /api/v1/risk/check → risk&#xa;• /api/v1/risk/rules → risk&#xa;• /api/v1/risk/blacklist → risk" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="400" y="460" width="250" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="kong-plugins" value="插件配置:&#xa;• CORS (全局)&#xa;• Rate Limiting (按服务)&#xa;• Request Logging&#xa;• Correlation ID&#xa;• JWT (待启用)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="700" y="460" width="200" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="kong-limits" value="限流策略:&#xa;• 账户API: 100/min, 1000/hour&#xa;• 支付API: 50/min, 500/hour&#xa;• 风控API: 200/min, 2000/hour" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="950" y="460" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- Consul服务注册中心 -->
        <mxCell id="consul-container" value="Consul服务注册中心 (Agent 5管理)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="50" y="660" width="600" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="consul-server" value="Consul Server&#xa;端口: 8500 (HTTP)&#xa;端口: 8600 (DNS)&#xa;UI: 已启用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="150" y="700" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="consul-services" value="已注册服务:&#xa;• core-bank-service (8080)&#xa;• payment-service (3000)&#xa;• risk-service (8000)&#xa;• kong-gateway (8000)&#xa;• nginx (80)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="380" y="700" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Kubernetes集群环境 -->
        <mxCell id="k8s-container" value="Kubernetes集群环境 (Agent 5 + Agent 8协作)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="700" y="660" width="650" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="k8s-namespace" value="命名空间:&#xa;digital-bank-poc" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="750" y="700" width="150" height="40" as="geometry" />
        </mxCell>
        
        <!-- 微服务Pod -->
        <mxCell id="core-bank-pod" value="core-bank-service&#xa;Pod (Spring Boot)&#xa;端口: 8080" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="750" y="760" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="payment-pod" value="payment-service&#xa;Pod (Node.js)&#xa;端口: 3000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="950" y="760" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="risk-pod" value="risk-service&#xa;Pod (FastAPI)&#xa;端口: 8000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1150" y="760" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- 数据库层 -->
        <mxCell id="db-container" value="数据存储层" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="750" y="840" width="550" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="postgres" value="PostgreSQL&#xa;(Agent 9管理)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="770" y="870" width="120" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="mongodb" value="MongoDB&#xa;(Agent 9管理)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="920" y="870" width="120" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="redis" value="Redis&#xa;(缓存)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1070" y="870" width="120" height="40" as="geometry" />
        </mxCell>
        
        <!-- 连接线：客户端到Nginx -->
        <mxCell id="edge1" value="HTTPS/HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="web-client" target="nginx-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge2" value="HTTPS/HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="mobile-client" target="nginx-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge3" value="HTTPS/HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="api-client" target="nginx-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 连接线：Nginx到Kong -->
        <mxCell id="edge4" value="/api/*" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#0066cc;" edge="1" parent="1" source="nginx-1" target="kong-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge5" value="/api/*" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#0066cc;" edge="1" parent="1" source="nginx-2" target="kong-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 连接线：Kong到微服务 -->
        <mxCell id="edge6" value="路由规则" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1" source="kong-gateway" target="core-bank-pod">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge7" value="路由规则" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1" source="kong-gateway" target="payment-pod">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge8" value="路由规则" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1" source="kong-gateway" target="risk-pod">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 连接线：Consul服务发现 -->
        <mxCell id="edge9" value="服务注册" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="core-bank-pod" target="consul-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge10" value="服务注册" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="payment-pod" target="consul-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge11" value="服务注册" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="risk-pod" target="consul-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge12" value="服务发现" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="consul-server" target="kong-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 连接线：微服务到数据库 -->
        <mxCell id="edge13" value="数据访问" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;" edge="1" parent="1" source="core-bank-pod" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge14" value="数据访问" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;" edge="1" parent="1" source="payment-pod" target="mongodb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge15" value="缓存访问" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="risk-pod" target="redis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 图例 -->
        <mxCell id="legend-container" value="图例" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=10" vertex="1" parent="1">
          <mxGeometry x="50" y="660" width="600" height="260" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-agent5" value="Agent 5管理组件" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="80" y="700" width="120" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-request" value="请求流" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="220" y="715" as="sourcePoint" />
            <mxPoint x="280" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="legend-service" value="服务发现" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="300" y="715" as="sourcePoint" />
            <mxPoint x="360" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="legend-text1" value="= Agent 5管理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="290" y="700" width="100" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-text2" value="= 请求流" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="370" y="700" width="80" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-text3" value="= 服务注册/发现" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="370" y="730" width="120" height="30" as="geometry" />
        </mxCell>
        
        <!-- Agent 5职责说明 -->
        <mxCell id="responsibilities" value="Agent 5核心职责:&#xa;• 配置Kong API Gateway路由规则和插件&#xa;• 管理Consul服务注册与发现&#xa;• 配置Nginx反向代理和负载均衡&#xa;• 生成基础设施即代码(IaC)脚本&#xa;• 确保服务间正确路由和通信" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="80" y="760" width="520" height="120" as="geometry" />
        </mxCell>
        
        <!-- 配置统计 -->
        <mxCell id="stats" value="配置统计 (Day 1完成):&#xa;• Kong路由规则: 9条&#xa;• Kong插件: 6个&#xa;• Consul注册服务: 5个&#xa;• Nginx上游服务: 5个&#xa;• Kubernetes资源: 10个" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;align=left;verticalAlign=top;spacingLeft=5" vertex="1" parent="1">
          <mxGeometry x="80" y="850" width="520" height="60" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
