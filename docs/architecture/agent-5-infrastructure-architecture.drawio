<mxfile host="app.diagrams.net">
  <diagram id="agent5-infrastructure" name="Agent 5 - 基础设施架构图">
    <mxGraphModel dx="2000" dy="1400" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="1600">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- 标题 -->
        <mxCell id="title" value="数字银行POC系统 - Agent 5 基础设施架构视图" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- 业务层标题 -->
        <mxCell id="business-layer-title" value="业务层 (Business Layer)" style="text;html=1;strokeColor=#F4B942;fillColor=#FFF8DC;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- 业务服务 -->
        <mxCell id="business-api-gateway" value="API网关管理业务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#FFD54F;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="140" width="200" height="60" as="geometry" />
        </mxCell>

        <mxCell id="business-service-registry" value="服务注册发现业务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#FFD54F;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="280" y="140" width="200" height="60" as="geometry" />
        </mxCell>

        <mxCell id="business-load-balancing" value="负载均衡业务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#FFD54F;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="510" y="140" width="200" height="60" as="geometry" />
        </mxCell>

        <mxCell id="business-infra-config" value="基础设施配置业务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#FFD54F;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="740" y="140" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- 应用层标题 -->
        <mxCell id="application-layer-title" value="应用层 (Application Layer) - 基础设施服务" style="text;html=1;strokeColor=#66BB6A;fillColor=#E8F5E9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="50" y="240" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Nginx反向代理组 -->
        <mxCell id="app-nginx-title" value="Nginx 反向代理层" style="text;html=1;strokeColor=#66BB6A;fillColor=#E8F5E9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;strokeWidth=1" vertex="1" parent="1">
          <mxGeometry x="50" y="300" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="app-nginx-1" value="Nginx 实例 1&#xa;端口: 80/443&#xa;负载均衡: least_conn" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="340" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="app-nginx-2" value="Nginx 实例 2&#xa;端口: 80/443&#xa;负载均衡: least_conn" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="260" y="340" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="app-nginx-features" value="功能: 反向代理、负载均衡&#xa;SSL终止、健康检查、Gzip压缩" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="470" y="340" width="220" height="70" as="geometry" />
        </mxCell>

        <!-- Kong API Gateway组 -->
        <mxCell id="app-kong-title" value="Kong API Gateway 层" style="text;html=1;strokeColor=#66BB6A;fillColor=#E8F5E9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;strokeWidth=1" vertex="1" parent="1">
          <mxGeometry x="50" y="430" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="app-kong-gateway" value="Kong API Gateway&#xa;端口: 8000 (代理)&#xa;端口: 8001 (管理)&#xa;模式: DB-less" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="470" width="200" height="80" as="geometry" />
        </mxCell>

        <mxCell id="app-kong-routes" value="路由规则服务&#xa;9条API路由配置" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="280" y="470" width="180" height="80" as="geometry" />
        </mxCell>

        <mxCell id="app-kong-plugins" value="插件服务&#xa;CORS、Rate Limiting&#xa;Logging、JWT" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="490" y="470" width="180" height="80" as="geometry" />
        </mxCell>

        <mxCell id="app-kong-limits" value="限流策略服务&#xa;账户API: 100/min&#xa;支付API: 50/min" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="700" y="470" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- Consul服务注册中心组 -->
        <mxCell id="app-consul-title" value="Consul 服务注册中心" style="text;html=1;strokeColor=#66BB6A;fillColor=#E8F5E9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;strokeWidth=1" vertex="1" parent="1">
          <mxGeometry x="50" y="570" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="app-consul-server" value="Consul Server&#xa;端口: 8500 (HTTP)&#xa;端口: 8600 (DNS)&#xa;UI: 已启用" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="610" width="200" height="80" as="geometry" />
        </mxCell>

        <mxCell id="app-consul-service-discovery" value="服务发现服务&#xa;已注册: 5个服务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="280" y="610" width="180" height="80" as="geometry" />
        </mxCell>

        <mxCell id="app-consul-health-check" value="健康检查服务" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#E8F5E9;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="490" y="610" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- 微服务Pod组 -->
        <mxCell id="app-pods-title" value="Kubernetes 微服务 Pod" style="text;html=1;strokeColor=#66BB6A;fillColor=#E8F5E9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;strokeWidth=1" vertex="1" parent="1">
          <mxGeometry x="50" y="710" width="250" height="30" as="geometry" />
        </mxCell>

        <mxCell id="app-core-bank-pod" value="core-bank-service&#xa;Pod (Spring Boot)&#xa;端口: 8080" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="750" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="app-payment-pod" value="payment-service&#xa;Pod (Node.js)&#xa;端口: 3000" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="260" y="750" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="app-risk-pod" value="risk-service&#xa;Pod (FastAPI)&#xa;端口: 8000" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="470" y="750" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="app-frontend-pod" value="frontend&#xa;Pod (React)&#xa;端口: 5173" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="680" y="750" width="180" height="70" as="geometry" />
        </mxCell>

        <!-- 数据层标题 -->
        <mxCell id="data-layer-title" value="数据层 (Data Layer)" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="50" y="860" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- 配置数据 -->
        <mxCell id="data-kong-config" value="Kong Config&#xa;路由配置数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="50" y="920" width="180" height="50" as="geometry" />
        </mxCell>

        <mxCell id="data-consul-data" value="Consul Data&#xa;服务注册数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="260" y="920" width="180" height="50" as="geometry" />
        </mxCell>

        <mxCell id="data-nginx-config" value="Nginx Config&#xa;代理配置数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="470" y="920" width="180" height="50" as="geometry" />
        </mxCell>

        <mxCell id="data-k8s-manifest" value="K8s Manifests&#xa;部署配置数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="680" y="920" width="180" height="50" as="geometry" />
        </mxCell>

        <!-- 数据库 -->
        <mxCell id="data-postgresql" value="PostgreSQL 15&#xa;核心银行数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="1000" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="data-mongodb" value="MongoDB 7.0&#xa;支付交易数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="260" y="1000" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="data-elasticsearch" value="Elasticsearch 8.x&#xa;风控日志数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="470" y="1000" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="data-redis" value="Redis&#xa;缓存数据" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#64B5F6;strokeColor=#666666;fontColor=#000000;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="680" y="1000" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- 技术层标题 -->
        <mxCell id="technology-layer-title" value="技术层 (Technology Layer)" style="text;html=1;strokeColor=#7CB342;fillColor=#DCEDC8;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="50" y="1100" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- 容器编排 -->
        <mxCell id="tech-kubernetes" value="Kubernetes&#xa;容器编排平台" style="shape=mxgraph.archimate3.application;appType=node;archiType=rounded;fillColor=#7CB342;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="1160" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-docker" value="Docker&#xa;容器运行时" style="shape=mxgraph.archimate3.application;appType=node;archiType=rounded;fillColor=#7CB342;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="260" y="1160" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- 系统软件 -->
        <mxCell id="tech-nginx-sw" value="Nginx 1.25&#xa;Web服务器" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="470" y="1160" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-kong-sw" value="Kong 3.x&#xa;API Gateway" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="680" y="1160" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-consul-sw" value="Consul 1.x&#xa;服务网格" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="1240" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-prometheus" value="Prometheus&#xa;监控指标" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="260" y="1240" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-grafana" value="Grafana&#xa;可视化仪表板" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="470" y="1240" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="tech-terraform" value="Terraform&#xa;基础设施即代码" style="shape=mxgraph.archimate3.application;appType=sysSw;archiType=rounded;fillColor=#AED581;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="680" y="1240" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- 图例 -->
        <mxCell id="legend-title" value="图例 (Legend)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="1340" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-bus" value="业务层" style="shape=mxgraph.archimate3.application;appType=serv;archiType=rounded;fillColor=#FFD54F;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="50" y="1380" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="legend-app" value="应用层" style="shape=mxgraph.archimate3.application;appType=comp;archiType=rounded;fillColor=#66BB6A;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="200" y="1380" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="legend-data" value="数据层" style="shape=mxgraph.archimate3.application;appType=passive;archiType=rounded;fillColor=#1976D2;strokeColor=#666666;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="350" y="1380" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="legend-tech" value="技术层" style="shape=mxgraph.archimate3.application;appType=node;archiType=rounded;fillColor=#7CB342;strokeColor=#666666;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="500" y="1380" width="120" height="40" as="geometry" />
        </mxCell>

        <!-- 说明文字 -->
        <mxCell id="note" value="说明：&#xa;1. 本架构图从Agent 5（应用基础设施层）的视角展示基础设施服务的内部架构&#xa;2. 采用ArchiMate 3.2标准，包含业务层、应用层、数据层、技术层四层架构&#xa;3. 应用层包含Nginx反向代理、Kong API Gateway、Consul服务注册中心和微服务Pod&#xa;4. Kong API Gateway配置: 9条路由规则、6个插件、按服务限流策略&#xa;5. Consul服务注册: 5个服务 (core-bank、payment、risk、kong、nginx)&#xa;6. 数据层: 配置数据 + 业务数据库 (PostgreSQL、MongoDB、Elasticsearch、Redis)&#xa;7. 技术层: Kubernetes + Docker 容器化部署，Prometheus + Grafana 监控&#xa;8. Agent 5核心职责: 配置Kong路由/插件、管理Consul服务注册、配置Nginx负载均衡、生成IaC脚本" style="text;html=1;strokeColor=#CCCCCC;fillColor=#F5F5F5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="50" y="1450" width="1100" height="160" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
