# Agent 依赖矩阵详细数据

> **版本**: v1.0
> **创建日期**: 2026-01-27
> **关联文档**: [Agent影响分析](agent-impact-analysis.md)

---

## 一、完整依赖矩阵

### 1.1 影响矩阵（行Agent变更 → 影响列Agent）

| 影响方↓ 被影响方→ | A0 | A1 | A2 | A3 | A4 | A5 | A6 | A7 | A8 | A9 | 强影响数 |
|-------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--------:|
| **A0 架构管控** | - | S | S | S | S | S | M | M | M | S | **6** |
| **A1 核心银行** | W | - | S | S | S | M | S | M | M | S | **5** |
| **A2 支付清算** | W | S | - | S | S | M | S | M | M | M | **4** |
| **A3 风控合规** | W | M | M | - | M | W | S | M | W | M | **1** |
| **A4 前端体验** | W | W | W | W | - | M | S | W | W | - | **1** |
| **A5 基础设施** | W | S | S | S | S | - | M | W | S | M | **5** |
| **A6 测试自动机** | M | M | M | M | M | M | - | W | M | W | **0** |
| **A7 安全扫描** | M | S | S | S | M | M | W | - | M | M | **3** |
| **A8 运维引擎** | W | S | S | S | S | S | M | W | - | M | **5** |
| **A9 数据分析师** | W | S | S | M | W | W | M | W | M | - | **2** |
| **被强影响数** | **0** | **5** | **5** | **4** | **4** | **2** | **3** | **0** | **2** | **2** | - |

### 1.2 依赖强度说明

| 符号 | 强度 | 含义 | 变更协调要求 |
|------|------|------|--------------|
| **S** | 强依赖 | 直接功能/数据依赖 | 必须同步变更，需联合测试 |
| **M** | 中依赖 | 接口/规范依赖 | 需提前通知，可能需适配 |
| **W** | 弱依赖 | 间接/管理依赖 | 可异步处理，通知即可 |
| **-** | 无依赖 | 无直接关联 | 无需协调 |

---

## 二、强依赖关系详表

### 2.1 数据依赖

| 依赖方 | 被依赖方 | 依赖资源 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A1 | A9 | PostgreSQL | 账户、交易、客户数据存储 | Schema变更需A1适配ORM |
| A2 | A9 | MongoDB | 支付订单、清算记录存储 | 文档结构变更需A2适配 |
| A3 | A9 | Elasticsearch | 风控日志、审计记录存储 | 索引结构变更需A3适配 |
| A1,A2,A3 | A9 | Redis | 分布式缓存 | Key格式变更需业务层适配 |

### 2.2 业务依赖

| 依赖方 | 被依赖方 | 依赖接口 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A2 | A1 | 账户API | 支付时查询/扣款账户 | API变更需A2同步适配 |
| A3 | A1 | 风控API | 获取账户风险画像 | API变更需A3同步适配 |
| A3 | A2 | 支付拦截API | 风控检查支付请求 | API变更需A3同步适配 |
| A4 | A1,A2,A3 | 全部业务API | 前端集成后端功能 | 后端API变更需前端适配 |

### 2.3 基础设施依赖

| 依赖方 | 被依赖方 | 依赖资源 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A1,A2,A3 | A5 | Kong网关 | API路由、限流、认证 | 路由配置变更影响服务可访问性 |
| A1,A2,A3 | A5 | Consul | 服务注册与发现 | 服务名变更影响服务间调用 |
| A8 | A5 | Kubernetes | 容器编排部署 | K8s配置变更影响部署流程 |
| A4 | A5 | CORS配置 | 跨域资源共享 | CORS变更影响前端API调用 |

### 2.4 测试依赖

| 依赖方 | 被依赖方 | 依赖内容 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A6 | A1 | API契约 | API测试用例 | API变更需更新测试用例 |
| A6 | A2 | API契约 | API测试用例 | API变更需更新测试用例 |
| A6 | A3 | API契约 | API测试用例 | API变更需更新测试用例 |
| A6 | A4 | UI组件 | E2E测试用例 | UI变更需更新E2E测试 |

### 2.5 安全依赖

| 依赖方 | 被依赖方 | 依赖内容 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A7 | A1 | 代码库 | SAST/依赖扫描 | 代码变更触发安全扫描 |
| A7 | A2 | 代码库 | SAST/依赖扫描 | 代码变更触发安全扫描 |
| A7 | A3 | 代码库 | SAST/依赖扫描 | 代码变更触发安全扫描 |
| A7 | A4 | 代码库 | 前端安全扫描 | 代码变更触发安全扫描 |

### 2.6 部署依赖

| 依赖方 | 被依赖方 | 依赖内容 | 依赖描述 | 变更影响 |
|--------|----------|----------|----------|----------|
| A8 | A1 | Dockerfile | 构建镜像 | 构建配置变更影响镜像 |
| A8 | A2 | Dockerfile | 构建镜像 | 构建配置变更影响镜像 |
| A8 | A3 | Dockerfile | 构建镜像 | 构建配置变更影响镜像 |
| A8 | A4 | Dockerfile | 构建镜像 | 构建配置变更影响镜像 |
| A8 | A5 | K8s配置 | 部署编排 | K8s配置变更影响部署 |

---

## 三、中依赖关系详表

| 依赖方 | 被依赖方 | 依赖类型 | 依赖描述 | 协调要求 |
|--------|----------|----------|----------|----------|
| A0 | A6 | 报告 | 测试报告反馈架构决策 | 定期同步 |
| A0 | A7 | 报告 | 安全报告反馈架构决策 | 定期同步 |
| A0 | A8 | 报告 | 部署状态反馈架构决策 | 定期同步 |
| A1 | A5 | 配置 | 服务注册配置 | 提前通知 |
| A1 | A7 | 扫描 | 安全扫描结果 | 漏洞修复 |
| A1 | A8 | 部署 | CI/CD流水线配置 | 提前通知 |
| A2 | A5 | 配置 | 服务注册配置 | 提前通知 |
| A2 | A7 | 扫描 | 安全扫描结果 | 漏洞修复 |
| A2 | A8 | 部署 | CI/CD流水线配置 | 提前通知 |
| A2 | A9 | 数据 | MongoDB配置 | 提前通知 |
| A3 | A1 | 业务 | 账户信息查询 | 接口变更通知 |
| A3 | A2 | 业务 | 支付状态查询 | 接口变更通知 |
| A3 | A7 | 扫描 | 安全扫描结果 | 漏洞修复 |
| A3 | A9 | 数据 | ES索引配置 | 提前通知 |
| A4 | A5 | 配置 | CORS配置 | 提前通知 |
| A4 | A7 | 扫描 | 前端安全扫描 | 漏洞修复 |
| A5 | A9 | 配置 | 数据库连接配置 | 提前通知 |
| A6 | A5 | 环境 | 测试环境依赖 | 环境变更通知 |
| A6 | A8 | 流程 | 测试集成到CI/CD | 流程变更通知 |
| A7 | A5 | 扫描 | 网关配置扫描 | 配置变更通知 |
| A7 | A8 | 流程 | 安全扫描集成到CI/CD | 流程变更通知 |
| A7 | A9 | 扫描 | 数据库配置扫描 | 配置变更通知 |
| A8 | A6 | 流程 | 测试阶段依赖 | 流程变更通知 |
| A8 | A7 | 流程 | 安全扫描阶段依赖 | 流程变更通知 |
| A8 | A9 | 运维 | 数据库备份任务 | 配置变更通知 |
| A9 | A8 | 运维 | 备份恢复脚本 | 脚本变更通知 |

---

## 四、弱依赖关系详表

| 依赖方 | 被依赖方 | 依赖类型 | 依赖描述 |
|--------|----------|----------|----------|
| A0 | A1 | 反馈 | 架构实施反馈 |
| A0 | A2 | 反馈 | 架构实施反馈 |
| A0 | A3 | 反馈 | 架构实施反馈 |
| A0 | A4 | 反馈 | 架构实施反馈 |
| A0 | A5 | 反馈 | 架构实施反馈 |
| A0 | A9 | 反馈 | 数据架构反馈 |
| A3 | A5 | 间接 | 网关日志分析 |
| A3 | A8 | 间接 | 监控数据分析 |
| A4 | A1 | 间接 | 通过网关访问 |
| A4 | A2 | 间接 | 通过网关访问 |
| A4 | A3 | 间接 | 通过网关访问 |
| A4 | A8 | 间接 | 部署状态查看 |
| A6 | A9 | 间接 | 测试数据准备 |
| A7 | A6 | 间接 | 测试结果参考 |
| A7 | A8 | 报告 | 安全报告输出 |

---

## 五、依赖统计分析

### 5.1 影响力分析

| Agent | 强依赖数 | 中依赖数 | 弱依赖数 | 总影响数 | 影响力评级 |
|-------|:--------:|:--------:|:--------:|:--------:|:----------:|
| A0 | 6 | 3 | 0 | 9 | **极高** |
| A5 | 5 | 1 | 0 | 6 | **高** |
| A8 | 5 | 1 | 0 | 6 | **高** |
| A1 | 5 | 3 | 1 | 9 | **高** |
| A2 | 4 | 4 | 1 | 9 | **高** |
| A7 | 3 | 4 | 2 | 9 | **中** |
| A9 | 2 | 7 | 0 | 9 | **中** |
| A3 | 1 | 6 | 2 | 9 | **中** |
| A4 | 1 | 1 | 4 | 6 | **低** |
| A6 | 0 | 8 | 1 | 9 | **低** |

### 5.2 被依赖度分析

| Agent | 被强依赖数 | 被中依赖数 | 被弱依赖数 | 总被依赖数 | 稳定性要求 |
|-------|:----------:|:----------:|:----------:|:----------:|:----------:|
| A1 | 5 | 2 | 2 | 9 | **极高** |
| A2 | 5 | 2 | 2 | 9 | **极高** |
| A3 | 4 | 2 | 2 | 8 | **高** |
| A4 | 4 | 1 | 0 | 5 | **中** |
| A5 | 2 | 5 | 1 | 8 | **高** |
| A9 | 2 | 7 | 1 | 10 | **高** |
| A6 | 3 | 2 | 1 | 6 | **中** |
| A8 | 2 | 6 | 2 | 10 | **中** |
| A0 | 0 | 3 | 6 | 9 | **低** |
| A7 | 0 | 4 | 1 | 5 | **低** |

### 5.3 依赖复杂度矩阵

```
                    被依赖度
              低 ◄─────────────────► 高
         ┌────────────────────────────────┐
     高  │        │              │        │
         │  A7    │     A8       │  A1    │
  影     │        │     A9       │  A2    │
  响     ├────────┼──────────────┼────────┤
  力     │        │              │        │
         │  A6    │     A5       │  A3    │
     低  │  A4    │              │        │
         └────────────────────────────────┘

象限说明:
- 右上(高影响力+高被依赖): 核心节点，变更需最谨慎 (A1, A2)
- 左上(高影响力+低被依赖): 决策节点，影响广但较稳定 (A7, A8)
- 右下(低影响力+高被依赖): 基础节点，被依赖但影响有限 (A3, A5)
- 左下(低影响力+低被依赖): 边缘节点，相对独立 (A4, A6)
```

---

## 六、依赖链路分析

### 6.1 最长依赖链

```
用户请求 → A4(前端) → A5(网关) → A1(核心银行) → A3(风控) → A9(ES)
                                      │
                                      └──► A2(支付) → A9(MongoDB)
                                                │
                                                └──► A9(Redis)
```

**链路长度**: 5层
**关键节点**: A5(网关)、A1(核心银行)
**风险点**: 任一节点故障会导致整条链路不可用

### 6.2 循环依赖检测

```
A1 ◄──────► A2 (业务调用)
│              │
│              ▼
└────────► A3 (风控检查)

检测结果:
- A1 → A2: 支付时调用账户扣款
- A2 → A1: 扣款前调用账户查询
- A1 → A3: 转账前调用风控检查
- A2 → A3: 支付前调用风控检查

结论: 存在业务层面的相互调用，但非循环依赖
建议: 通过异步消息解耦非关键路径调用
```

### 6.3 关键依赖路径

| 业务场景 | 依赖路径 | 关键节点 | SLA要求 |
|----------|----------|----------|---------|
| 账户查询 | A4→A5→A1→A9 | A5, A1 | < 1s |
| 转账交易 | A4→A5→A1→A3→A1→A9 | A5, A1, A3 | < 2s |
| 支付请求 | A4→A5→A2→A3→A1→A9 | A5, A2, A3, A1 | < 2s |
| 风控查询 | A4→A5→A3→A9 | A5, A3 | < 500ms |

---

## 七、变更影响评估矩阵

### 7.1 按变更类型分析

| 变更类型 | 直接影响Agent | 需回归测试范围 | 协调复杂度 |
|----------|---------------|----------------|------------|
| API格式变更 | A1,A2,A3,A4,A6 | 全量API测试 | **高** |
| 数据库Schema变更 | A1,A2,A3,A9 | 数据迁移+业务测试 | **极高** |
| 网关配置变更 | A1,A2,A3,A4,A5 | 路由测试+E2E测试 | **高** |
| 错误码变更 | A1,A2,A3,A4 | 异常场景测试 | **中** |
| 缓存策略变更 | A1,A2,A3,A9 | 性能测试 | **中** |
| 部署配置变更 | A1-A5,A8 | 部署验证 | **高** |
| 安全策略变更 | A1,A2,A3,A4,A5,A7 | 安全测试 | **高** |
| 监控告警变更 | A1,A2,A3,A8 | 告警验证 | **低** |

### 7.2 按Agent变更分析

| 变更Agent | 需通知Agent | 需同步变更Agent | 预计协调时间 |
|-----------|-------------|-----------------|--------------|
| A0 | 全部 | A1,A2,A3,A5,A9 | 1-2天 |
| A1 | A0,A2,A3,A4,A6,A7 | A2,A4,A6 | 4-8小时 |
| A2 | A0,A1,A3,A4,A6,A7 | A1,A4,A6 | 4-8小时 |
| A3 | A0,A1,A2,A4,A6,A7 | A4,A6 | 2-4小时 |
| A4 | A0,A6 | A6 | 1-2小时 |
| A5 | A0,A1,A2,A3,A4,A8 | A1,A2,A3,A4 | 4-8小时 |
| A6 | A0,A8 | - | 1小时 |
| A7 | A0,A8 | - | 1小时 |
| A8 | A0,A5,A6,A7 | A5 | 2-4小时 |
| A9 | A0,A1,A2,A3,A8 | A1,A2 | 4-8小时 |

---

## 八、使用指南

### 8.1 如何使用本矩阵

1. **变更前**: 查找变更Agent所在行，识别所有S和M依赖
2. **评估影响**: 统计受影响Agent数量，评估协调复杂度
3. **制定计划**: 根据依赖强度决定同步/异步变更策略
4. **执行协调**: 按优先级通知受影响Agent
5. **验证完成**: 确保所有依赖方完成适配

### 8.2 矩阵维护要求

- **更新频率**: 每次架构变更后更新
- **审核责任**: A0负责审核矩阵准确性
- **版本管理**: 保留历史版本用于追溯

---

**文档版本**: v1.0
**创建日期**: 2026-01-27
**维护者**: Digital Bank POC Team
