# Agent 5: åº”ç”¨åŸºç¡€è®¾æ–½å±‚æ¶æ„å›¾è¯´æ˜

**åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
**åˆ›å»ºè€…**: Agent 5 (åº”ç”¨åŸºç¡€è®¾æ–½å±‚)  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°Agent 5è´Ÿè´£çš„åº”ç”¨åŸºç¡€è®¾æ–½å±‚æ¶æ„ï¼ŒåŒ…æ‹¬APIç½‘å…³ã€æœåŠ¡æ³¨å†Œå‘ç°ã€åå‘ä»£ç†ç­‰æ ¸å¿ƒç»„ä»¶çš„é…ç½®å’Œäº¤äº’å…³ç³»ã€‚

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

### 1. å®¢æˆ·ç«¯å±‚

**ç»„ä»¶**:
- **Webæµè§ˆå™¨** (Reactå‰ç«¯) - Agent 4å¼€å‘
- **ç§»åŠ¨åº”ç”¨** (iOS/Android) - Agent 4å¼€å‘
- **ç¬¬ä¸‰æ–¹APIå®¢æˆ·ç«¯** - å¤–éƒ¨ç³»ç»Ÿé›†æˆ

**è®¿é—®æ–¹å¼**: HTTPS/HTTPåè®®

### 2. Nginxåå‘ä»£ç†å±‚ (Agent 5ç®¡ç†)

**é…ç½®**:
- **å®ä¾‹æ•°é‡**: 2ä¸ªï¼ˆé«˜å¯ç”¨ï¼‰
- **ç«¯å£**: 80 (HTTP), 443 (HTTPS)
- **è´Ÿè½½å‡è¡¡ç®—æ³•**: `least_conn` (æœ€å°‘è¿æ¥)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åå‘ä»£ç†
- âœ… è´Ÿè½½å‡è¡¡
- âœ… SSLç»ˆæ­¢ï¼ˆå¾…é…ç½®ï¼‰
- âœ… å¥åº·æ£€æŸ¥
- âœ… Gzipå‹ç¼©

**ä»£ç†è§„åˆ™**:
- `/api/*` â†’ Kong API Gateway
- `/consul/*` â†’ Consul UI
- `/core-bank/*` â†’ æ ¸å¿ƒé“¶è¡ŒæœåŠ¡ï¼ˆå¼€å‘ç¯å¢ƒç›´è¿ï¼‰
- `/payment/*` â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå¼€å‘ç¯å¢ƒç›´è¿ï¼‰
- `/risk/*` â†’ é£æ§æœåŠ¡ï¼ˆå¼€å‘ç¯å¢ƒç›´è¿ï¼‰

### 3. Kong API Gatewayå±‚ (Agent 5ç®¡ç†)

**é…ç½®**:
- **ä»£ç†ç«¯å£**: 8000
- **ç®¡ç†ç«¯å£**: 8001
- **è¿è¡Œæ¨¡å¼**: DB-less (å£°æ˜å¼é…ç½®)

**è·¯ç”±è§„åˆ™** (9æ¡):
1. `/api/v1/accounts` â†’ core-bank-service
2. `/api/v1/customers` â†’ core-bank-service
3. `/api/v1/transactions` â†’ core-bank-service
4. `/api/v1/payments` â†’ payment-service
5. `/api/v1/settlements` â†’ payment-service
6. `/api/v1/payments/callback` â†’ payment-service
7. `/api/v1/risk/check` â†’ risk-service
8. `/api/v1/risk/rules` â†’ risk-service
9. `/api/v1/risk/blacklist` â†’ risk-service

**æ’ä»¶é…ç½®** (6ä¸ª):
1. **CORS** (å…¨å±€) - è·¨åŸŸèµ„æºå…±äº«
2. **Rate Limiting** (æŒ‰æœåŠ¡) - é™æµæ§åˆ¶
3. **Request Logging** - è¯·æ±‚æ—¥å¿—è®°å½•
4. **Correlation ID** - è¯·æ±‚è¿½è¸ª
5. **JWT** (å¾…å¯ç”¨) - èº«ä»½è®¤è¯
6. **File Log** - æ–‡ä»¶æ—¥å¿—

**é™æµç­–ç•¥**:
- **è´¦æˆ·API**: 100æ¬¡/åˆ†é’Ÿ, 1000æ¬¡/å°æ—¶
- **æ”¯ä»˜API**: 50æ¬¡/åˆ†é’Ÿ, 500æ¬¡/å°æ—¶ï¼ˆæ›´ä¸¥æ ¼ï¼‰
- **é£æ§API**: 200æ¬¡/åˆ†é’Ÿ, 2000æ¬¡/å°æ—¶

### 4. ConsulæœåŠ¡æ³¨å†Œä¸­å¿ƒ (Agent 5ç®¡ç†)

**é…ç½®**:
- **HTTPç«¯å£**: 8500
- **DNSç«¯å£**: 8600
- **UI**: å·²å¯ç”¨
- **æ¨¡å¼**: å•èŠ‚ç‚¹ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**å·²æ³¨å†ŒæœåŠ¡** (5ä¸ª):
1. `core-bank-service` (8080) - æ ¸å¿ƒé“¶è¡ŒæœåŠ¡
2. `payment-service` (3000) - æ”¯ä»˜æ¸…ç®—æœåŠ¡
3. `risk-service` (8000) - é£æ§åˆè§„æœåŠ¡
4. `kong-gateway` (8000) - Kong API Gateway
5. `nginx` (80) - Nginxåå‘ä»£ç†

**åŠŸèƒ½**:
- âœ… æœåŠ¡æ³¨å†Œä¸å‘ç°
- âœ… å¥åº·æ£€æŸ¥
- âœ… é…ç½®ç®¡ç†
- âœ… æœåŠ¡ç½‘æ ¼ï¼ˆConnectï¼‰

### 5. Kubernetesé›†ç¾¤ç¯å¢ƒ (Agent 5 + Agent 8åä½œ)

**å‘½åç©ºé—´**: `digital-bank-poc`

**å¾®æœåŠ¡Pod**:
- **core-bank-service** (Spring Boot) - ç«¯å£ 8080
- **payment-service** (Node.js) - ç«¯å£ 3000
- **risk-service** (FastAPI) - ç«¯å£ 8000

**éƒ¨ç½²æ–¹å¼**:
- ä½¿ç”¨Kubernetes Deployment
- é€šè¿‡Serviceæš´éœ²æœåŠ¡
- ä½¿ç”¨ConfigMapç®¡ç†é…ç½®

### 6. æ•°æ®å­˜å‚¨å±‚ (Agent 9ç®¡ç†)

**æ•°æ®åº“**:
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“ï¼ˆè´¦æˆ·ã€å®¢æˆ·ã€äº¤æ˜“æ•°æ®ï¼‰
- **MongoDB** - æ–‡æ¡£æ•°æ®åº“ï¼ˆæ”¯ä»˜ã€æ¸…ç®—æ•°æ®ï¼‰
- **Redis** - ç¼“å­˜ï¼ˆé£æ§è§„åˆ™ã€ä¼šè¯æ•°æ®ï¼‰

## ğŸ”„ è¯·æ±‚æµç¨‹

### å…¸å‹APIè¯·æ±‚æµç¨‹

1. **å®¢æˆ·ç«¯è¯·æ±‚** â†’ Nginxåå‘ä»£ç†
   - å®¢æˆ·ç«¯å‘é€HTTPS/HTTPè¯·æ±‚åˆ°Nginx

2. **Nginxè·¯ç”±** â†’ Kong API Gateway
   - Nginxå°† `/api/*` è·¯å¾„çš„è¯·æ±‚è½¬å‘åˆ°Kong

3. **Kongå¤„ç†**:
   - åº”ç”¨æ’ä»¶ï¼ˆCORSã€é™æµã€æ—¥å¿—ç­‰ï¼‰
   - æ ¹æ®è·¯ç”±è§„åˆ™è½¬å‘åˆ°å¯¹åº”å¾®æœåŠ¡
   - è®°å½•è¯·æ±‚æ—¥å¿—å’Œè¿½è¸ªID

4. **æœåŠ¡å‘ç°**:
   - Kongé€šè¿‡Consulå‘ç°æœåŠ¡åœ°å€
   - æˆ–ç›´æ¥ä½¿ç”¨Kubernetes Service DNS

5. **å¾®æœåŠ¡å¤„ç†**:
   - æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ä¸šåŠ¡é€»è¾‘
   - è®¿é—®æ•°æ®åº“è·å–æ•°æ®
   - è¿”å›å“åº”

6. **å“åº”è¿”å›**:
   - å“åº”æ²¿åŸè·¯å¾„è¿”å›
   - ç»è¿‡Kongã€Nginxæœ€ç»ˆåˆ°è¾¾å®¢æˆ·ç«¯

## ğŸ”Œ Agent 5æ ¸å¿ƒèŒè´£

### é…ç½®ç®¡ç†

1. **Kong API Gateway**:
   - é…ç½®è·¯ç”±è§„åˆ™ï¼ˆ9æ¡ï¼‰
   - é…ç½®æ’ä»¶ï¼ˆ6ä¸ªï¼‰
   - é…ç½®é™æµç­–ç•¥
   - ç®¡ç†æœåŠ¡å®šä¹‰

2. **ConsulæœåŠ¡æ³¨å†Œä¸­å¿ƒ**:
   - é…ç½®æœåŠ¡æ³¨å†Œ
   - é…ç½®å¥åº·æ£€æŸ¥
   - ç®¡ç†æœåŠ¡å‘ç°

3. **Nginxåå‘ä»£ç†**:
   - é…ç½®è´Ÿè½½å‡è¡¡
   - é…ç½®ä»£ç†è§„åˆ™
   - é…ç½®SSL/TLSï¼ˆå¾…å®Œæˆï¼‰

4. **Kubernetesèµ„æº**:
   - åˆ›å»ºDeploymenté…ç½®
   - åˆ›å»ºServiceé…ç½®
   - åˆ›å»ºConfigMapé…ç½®

### åŸºç¡€è®¾æ–½å³ä»£ç (IaC)

- **Terraformé…ç½®**: `infrastructure/terraform/main.tf`
- **Kubernetesé…ç½®**: `infrastructure/k8s/base/`
- **è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**: `dev-environment-setup.sh`

## ğŸ“Š é…ç½®ç»Ÿè®¡ (Day 1å®Œæˆ)

- âœ… **Kongè·¯ç”±è§„åˆ™**: 9æ¡
- âœ… **Kongæ’ä»¶**: 6ä¸ª
- âœ… **Consulæ³¨å†ŒæœåŠ¡**: 5ä¸ª
- âœ… **Nginxä¸Šæ¸¸æœåŠ¡**: 5ä¸ª
- âœ… **Kubernetesèµ„æº**: 10ä¸ª
- âœ… **é…ç½®æ–‡ä»¶æ€»æ•°**: 15ä¸ª

## ğŸ”— åä½œå…³ç³»

### ä¸Agent 1 (æ ¸å¿ƒé“¶è¡ŒæœåŠ¡å¼•æ“)
- é…ç½®core-bank-serviceçš„è·¯ç”±è§„åˆ™
- é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- é…ç½®é™æµç­–ç•¥

### ä¸Agent 2 (æ”¯ä»˜æ¸…ç®—å¤„ç†å™¨)
- é…ç½®payment-serviceçš„è·¯ç”±è§„åˆ™
- é…ç½®æ”¯ä»˜APIçš„é™æµç­–ç•¥ï¼ˆæ›´ä¸¥æ ¼ï¼‰
- é…ç½®å›è°ƒè·¯ç”±

### ä¸Agent 3 (é£æ§åˆè§„å®ˆæŠ¤è€…)
- é…ç½®risk-serviceçš„è·¯ç”±è§„åˆ™
- é…ç½®é£æ§APIçš„é™æµç­–ç•¥
- é…ç½®æœåŠ¡é—´è°ƒç”¨

### ä¸Agent 8 (è¿ç»´è‡ªåŠ¨åŒ–å¼•æ“)
- åä½œKuberneteséƒ¨ç½²
- é…ç½®ç›‘æ§å’Œå‘Šè­¦
- é…ç½®CI/CDæµæ°´çº¿

### ä¸Agent 6 (æµ‹è¯•æ‰§è¡Œè‡ªåŠ¨æœº)
- æä¾›æµ‹è¯•ç¯å¢ƒè®¿é—®
- é…ç½®æµ‹è¯•è·¯ç”±è§„åˆ™
- æä¾›APIç½‘å…³æµ‹è¯•æ¥å£

### ä¸Agent 7 (å®‰å…¨æ‰«æå«å£«)
- é…ç½®å®‰å…¨ç­–ç•¥
- é…ç½®JWTè®¤è¯ï¼ˆå¾…å¯ç”¨ï¼‰
- é…ç½®SSL/TLSè¯ä¹¦

## ğŸ¯ å…³é”®é‡Œç¨‹ç¢‘

- âœ… **Day 1**: åŸºç¡€è®¾æ–½é…ç½®å®Œæˆï¼ŒDevç¯å¢ƒå°±ç»ª
- â³ **Day 3**: æ ¸å¿ƒé“¶è¡ŒæœåŠ¡è·¯ç”±é…ç½®å®Œæˆ
- â³ **Day 5**: æ‰€æœ‰æœåŠ¡è·¯ç”±å’Œé™æµé…ç½®å®Œæˆ
- â³ **Day 8**: æœåŠ¡ç½‘æ ¼é…ç½®å®Œæˆ

## ğŸ“ ç›¸å…³æ–‡ä»¶

### é…ç½®æ–‡ä»¶
- `infrastructure/kong/kong.yml` - Kong API Gatewayé…ç½®
- `infrastructure/consul/consul-config.json` - Consulé…ç½®
- `infrastructure/nginx/nginx.conf` - Nginxé…ç½®
- `infrastructure/k8s/base/` - Kubernetesé…ç½®

### éƒ¨ç½²è„šæœ¬
- `infrastructure/dev-environment-setup.sh` - éƒ¨ç½²è„šæœ¬
- `infrastructure/dev-environment-verify.sh` - éªŒè¯è„šæœ¬
- `infrastructure/terraform/main.tf` - Terraformé…ç½®

### æ–‡æ¡£
- `infrastructure/README.md` - åŸºç¡€è®¾æ–½æ–‡æ¡£
- `infrastructure/DEPLOYMENT-GUIDE.md` - éƒ¨ç½²æŒ‡å—
- `infrastructure/WINDOWS-DEPLOYMENT-GUIDE.md` - Windowséƒ¨ç½²æŒ‡å—

## ğŸ” æ¶æ„å›¾è¯´æ˜

æ¶æ„å›¾æ–‡ä»¶: `agent-5-infrastructure-architecture.drawio`

**å›¾ä¾‹**:
- **é»„è‰²åŒºåŸŸ**: Agent 5ç®¡ç†çš„ç»„ä»¶
- **è“è‰²åŒºåŸŸ**: Kong API Gatewayå±‚
- **ç´«è‰²åŒºåŸŸ**: ConsulæœåŠ¡æ³¨å†Œä¸­å¿ƒ
- **ç»¿è‰²åŒºåŸŸ**: å¾®æœåŠ¡Pod
- **çº¢è‰²åŒºåŸŸ**: Kubernetesé›†ç¾¤ç¯å¢ƒ

**è¿æ¥çº¿**:
- **å®çº¿**: è¯·æ±‚æµ
- **è™šçº¿**: æœåŠ¡æ³¨å†Œ/å‘ç°

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ç­‰å¾…å¾®æœåŠ¡éƒ¨ç½²**: Agent 1ã€2ã€3éƒ¨ç½²åº”ç”¨æœåŠ¡åï¼ŒéªŒè¯è·¯ç”±è§„åˆ™
2. **ä¼˜åŒ–é…ç½®**: æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´é™æµç­–ç•¥å’Œèµ„æºé…ç½®
3. **å¯ç”¨å®‰å…¨åŠŸèƒ½**: é…ç½®JWTè®¤è¯å’ŒSSL/TLSè¯ä¹¦
4. **æœåŠ¡ç½‘æ ¼**: é…ç½®æœåŠ¡é—´é€šä¿¡å’Œç†”æ–­æœºåˆ¶

---

**ç»´æŠ¤è€…**: Agent 5 (åº”ç”¨åŸºç¡€è®¾æ–½å±‚)  
**æœ€åæ›´æ–°**: 2026-01-26
