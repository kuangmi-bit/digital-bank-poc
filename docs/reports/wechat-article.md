## 数字银行 POC：一场“多 AI Agent 协作交付”的架构实验（14 天复盘）

> 写在前面：这不是一篇“功能介绍”，而是一份“工程组织可行性验证”的复盘记录。  
> 我们用 14 天、10 个 AI Agent，模拟一个银行系统从架构决策到交付验收的全流程，试图回答一个问题：**多 AI 协作，能不能在工程约束下稳定交付复杂系统 POC？**

---

## 一、起源：我们要验证的不是“银行功能”，而是“多 AI 协作可交付”

很多人以为 POC 只是“做个能跑的 Demo”。但这次我们做的不是传统意义的业务 POC，而是一场**工程与组织能力的架构实验**：在 14 天窗口内，用 **10 个 AI Agent** 分工协作，模拟一个数字银行系统从规划、决策、实现、测试、上线到交付的全流程，验证这种模式是否能稳定产出“可运行、可验收、可复用”的 POC 资产。

**项目的起源只有一句话**：验证“多 AI 协作模拟银行系统 POC”的可行性。  
我们要证明的不是“某个功能点能不能做”，而是一个更难的问题：在多技术栈、多服务、多团队（多 Agent）并行的条件下，能否通过**双决策窗口 + ADR 决策契约 + 技术标准 + 自动化测试/安全/性能门禁 + 每日简报闭环**，把复杂系统按期收敛并交付。

图1（draw.io）：项目目标金字塔（从“协作可交付”到“功能/性能/安全”）
- `docs/reports/diagrams/01-project-goals-pyramid.drawio`

---

## 二、计划：把不确定性关进笼子里（四阶段 + 双决策窗口 + 契约化）

我们把 14 天拆成 4 个阶段，并为每一阶段定义“必须交付的工程资产”，避免只堆代码不成体系。

### 1）四阶段节奏：先修路，再开车

- **阶段 1（Day 1–2）**：架构设计与基础设施就绪（规范、网关、CI/CD、数据字典、安全基线）
- **阶段 2（Day 3–7）**：核心服务开发（核心银行/支付/风控 + 前端主流程）
- **阶段 3（Day 8–11）**：扩展功能 + 集成与测试（批量/预约/账单、性能与安全）
- **阶段 4（Day 12–14）**：文档、验收、交付（API 参考、部署清单、演示脚本、最终报告）

图2（draw.io）：10 个 Agent 的组织与分工边界（可复制的协作结构）
- `docs/reports/diagrams/02-agent-team-architecture.drawio`

### 2）双决策窗口：让架构收敛，而不是发散

每天固定两次决策窗口，把“架构治理”从口头沟通升级为可追溯机制：
- **10:00–12:00（窗口 1）**：审查/审批/协调（把关方向、合约与标准）
- **22:00–23:00（窗口 2）**：复盘/简报/规划（把关质量与进度收敛）

图3（draw.io）：双决策窗口机制（协作的节拍器）
- `docs/reports/diagrams/03-daily-decision-windows.drawio`

### 3）“契约化”是并行协作的前提：ADR + 技术标准

我们把关键决策写进 ADR，把工程规则写进技术标准，并在后续实践中升级标准版本（v1.0 → v2.0）。

几个对结果影响最大的决策是：
- **服务拆分**：核心银行/支付/风控 + 前端（微服务边界清晰，职责可解释）
- **服务间通信**：REST over HTTP 为主（POC 周期内可调试、可测试、可观测）
- **协议级合约**：明确“谁调谁、调什么、幂等怎么做、错误码怎么统一”
- **异步边界**：同步主链路 + 回调后异步（避免引入过多中间件复杂度）

图4（draw.io）：系统总体架构（从前端到网关到服务与数据）
- `docs/reports/diagrams/04-system-architecture.drawio`

图5（draw.io）：服务交互矩阵（谁依赖谁、如何避免循环依赖）
- `docs/reports/diagrams/05-service-interaction-matrix.drawio`

---

## 三、执行：用“每日简报 + 质量门禁”把并行协作变成确定交付

如果说计划解决的是“方向”，执行要解决的就是“偏差”。我们的做法是：**每一天都留痕**——日终简报记录事实、阻塞、风险与次日计划；关键节点用阶段报告/最终报告做归档。

### 1）Day 1–2：先把工程跑道铺好

这两天的目标不是写业务功能，而是把“协作能跑起来”的基础设施打牢：
- 网关/服务发现（Kong/Consul）
- CI/CD 流水线与监控告警
- 数据字典与迁移脚本
- 安全基线与扫描工具链
- 技术标准 v1.0 与命名规范

从架构师视角，这是在回答：**多 Agent 协作，靠什么对齐？**答案是“标准 + 目录结构 + 自动化 + 可观测性”。

### 2）Day 3：第一个典型转折——合约缺口比代码缺口更致命

Day 3 的审查发现了一个关键问题：支付需要“扣款”，但核心银行缺少明确的扣款端点。  
这类问题并不可怕，可怕的是不把它当成“合约缺口”来处理。

处理方式是：
- 在 ADR 里明确推荐方案：**`POST /api/v1/transactions/debit` + `refId` 幂等**
- 给出过渡方案与清偿期限（避免长期技术债）
- 在简报里记录为阻塞项，责任人明确，次日计划硬化到任务清单

这一步的意义在于：**并行协作必须以合约为基线**，否则联调只会变成“谁都觉得自己写对了”。

图6（draw.io）：转账/关键链路时序（用链路图把“合约”落到请求级）
- `docs/reports/diagrams/08-transfer-sequence.drawio`

### 3）Day 5：第二个转折——工程问题会“拖死”交付可信度

Day 5 的集成测试暴露了典型的“工程型阻塞”：
- Core Bank：Mockito/JDK 兼容导致大量测试失败
- Payment：mongodb-memory-server 下载超时导致用例跳过
- Risk：规则引擎断言失败
- Frontend：覆盖率不足

这些问题不属于业务需求，但直接影响交付可信度。我们把它们作为 Day 6 的 P1/P2 任务处理，并沉淀进 **technical-standards v2.0**（接口抽象、外部依赖配置、幂等规范等），形成防复发机制。

### 4）Day 8–9：扩展功能完成后，马上做“性能与安全的反向验证”

Day 8 扩展功能（批量/预约/账单支付）全栈完成；Day 9 随即补齐：
- 风控规则扩展（批量/预约限额规则）
- 扩展功能性能测试与报告
- 新增 API 安全复核与整改建议（账户归属校验、日志脱敏）

这代表一种工程习惯：**不是“做完功能就算完”，而是“做完功能就进入验证环节”**。

图7（draw.io）：风控引擎流程（规则、评分、拦截与证据链）
- `docs/reports/diagrams/09-risk-engine-flow.drawio`

图8（draw.io）：安全分层（从输入验证到授权、审计与脱敏）
- `docs/reports/diagrams/15-security-layers.drawio`

### 5）Day 10–11：性能工程化与安全加固成为“可验收”的硬指标

Day 10 把优化落在可解释的位置：连接池、索引迁移、缓存 TTL、HPA 弹性伸缩。  
Day 11 把 Day 9 安全建议落到代码里：账户归属校验、日志脱敏，并通过测试覆盖率报告固化结果。

图9（draw.io）：测试金字塔（质量不是口号，是结构）
- `docs/reports/diagrams/12-test-pyramid.drawio`

### 6）Day 12–14：交付不仅是代码，更是“可复用资产”

我们在最后三天把交付做成“可交接”：
- API 参考文档 v1.0
- 生产部署检查清单（配置/安全/监控/备份/发布流程）
- 20 分钟演示脚本
- Day 13 验收（功能/性能/安全/部署全维度）
- Day 14 最终交付（总结 + 复盘 + 最终报告）

---

## 四、结果：多 AI 协作“可交付”了吗？用数据回答

从最终验收与报告汇总，关键结果可以用几组数字来描述：
- **验收用例**：123 条功能用例，100% 通过
- **测试覆盖**：总体覆盖率达到并超过目标（各服务行覆盖率 82%–92% 区间）
- **性能验收**：关键 API 达标（例如转账 TPS 120、P95 350ms；批量转账 TPS 12、P95 1.2s 等）
- **安全验收**：高危 0；并完成账户归属校验、日志脱敏等关键加固
- **交付资产**：ADR、技术标准、每日简报、测试/安全/性能报告、部署与演示材料齐全

从“多 AI 协作可行性”角度，我更关注三点：
1. **契约是否能约束并行开发**：ADR + OpenAPI + 技术标准实现了“可对齐”
2. **偏差是否能被及时发现与纠偏**：双决策窗口 + 每日简报让风险显性化
3. **质量是否能被工程化固化**：测试金字塔、质量门禁、验收报告让结果可复现

---

## 五、架构师的结语：POC 的真正产物，是“可复制的交付方法”

这次项目最大的收获，不是“做出了一个银行系统”，而是验证了一套路径：

- **用组织机制管理复杂度**（分工边界 + 决策节奏）
- **用契约管理协作成本**（ADR/标准/OpenAPI）
- **用工程门禁管理交付可信度**（测试/安全/性能/部署验收）
- **用文档把过程变成资产**（简报、报告、清单、演示脚本）

如果后续要从 POC 走向产品化，我会优先把复盘中的“可改进项”列为 roadmap：
- 预约调度的分布式锁（多实例一致性）
- 性能测试纳入 CI/CD（自动化回归）
- 业务指标监控更细颗粒（可观测性从系统到业务）
- 审计日志能力服务化（合规与追责）

---

## 附：本文引用的 draw.io 图文件清单

- `docs/reports/diagrams/01-project-goals-pyramid.drawio`
- `docs/reports/diagrams/02-agent-team-architecture.drawio`
- `docs/reports/diagrams/03-daily-decision-windows.drawio`
- `docs/reports/diagrams/04-system-architecture.drawio`
- `docs/reports/diagrams/05-service-interaction-matrix.drawio`
- `docs/reports/diagrams/08-transfer-sequence.drawio`
- `docs/reports/diagrams/09-risk-engine-flow.drawio`
- `docs/reports/diagrams/12-test-pyramid.drawio`
- `docs/reports/diagrams/15-security-layers.drawio`

