{
  "info": {
    "name": "Core Bank Service - API Tests",
    "description": "数字银行 POC 核心银行服务 API 测试（基于 OpenAPI）。路径 /api/v1/，遵循 naming-conventions。目标 20+ 用例。",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [{ "key": "core_bank_base_url", "value": "http://localhost:8080" }],
  "item": [
    {
      "name": "Health",
      "item": [{
        "name": "GET 健康检查",
        "request": { "method": "GET", "header": [], "url": "{{core_bank_base_url}}/actuator/health" },
        "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status code is 200\", () => pm.response.to.have.status(200));", "pm.test(\"Response time < 2000ms\", () => pm.expect(pm.response.responseTime).to.be.below(2000));"], "type": "text/javascript" } }]
      }]
    },
    {
      "name": "Accounts",
      "item": [
        { "name": "POST 开户 - 成功", "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status code is 201\", () => pm.response.to.have.status(201));", "const j=pm.response.json(); const d=j.data||j; if(d.accountId)pm.environment.set(\"account_id\",d.accountId); if(d.customerId)pm.environment.set(\"customer_id\",d.customerId);", "pm.test(\"has accountId\", () => { const d=(pm.response.json().data||pm.response.json()); pm.expect(d).to.have.property(\"accountId\"); });"], "type": "text/javascript" } }], "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"customerId\":1,\"accountType\":\"savings\",\"currency\":\"CNY\"}" }, "url": "{{core_bank_base_url}}/api/v1/accounts" } },
        { "name": "POST 开户 - 400 缺 customerId", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"accountType\":\"savings\"}" }, "url": "{{core_bank_base_url}}/api/v1/accounts" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 400 or 500\", () => pm.expect([400,500]).to.include(pm.response.code));"], "type": "text/javascript" } }] },
        { "name": "GET 账户列表 - 分页", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/accounts?page=1&pageSize=10", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","accounts"], "query": [{"key":"page","value":"1"},{"key":"pageSize","value":"10"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200\", () => pm.response.to.have.status(200));", "const j=pm.response.json(); const d=j.data||j; pm.expect(d).to.satisfy(v=>v.items!==undefined||Array.isArray(v));"], "type": "text/javascript" } }] },
        { "name": "GET 账户列表 - 按 customerId", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/accounts?customerId={{customer_id}}&page=1&pageSize=10", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","accounts"], "query": [{"key":"customerId","value":"{{customer_id}}"},{"key":"page","value":"1"},{"key":"pageSize","value":"10"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200\", () => pm.response.to.have.status(200));"], "type": "text/javascript" } }] },
        { "name": "GET 账户列表 - 按 status", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/accounts?status=active&page=1&pageSize=5", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","accounts"], "query": [{"key":"status","value":"active"},{"key":"page","value":"1"},{"key":"pageSize","value":"5"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200\", () => pm.response.to.have.status(200));"], "type": "text/javascript" } }] },
        { "name": "GET 账户详情", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/accounts/{{account_id}}" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 404\", () => pm.expect([200,404]).to.include(pm.response.code));", "if(pm.response.code===200){ const d=pm.response.json().data||pm.response.json(); pm.test(\"has accountNumber\", ()=>pm.expect(d).to.have.property(\"accountNumber\")); }"], "type": "text/javascript" } }] },
        { "name": "GET 账户详情 - 404", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/accounts/99999999" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 404\", () => pm.response.to.have.status(404));"], "type": "text/javascript" } }] },
        { "name": "GET 余额查询", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/accounts/{{account_id}}/balance" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 404\", () => pm.expect([200,404]).to.include(pm.response.code));", "if(pm.response.code===200){ const d=pm.response.json().data||pm.response.json(); pm.test(\"has balance,currency\", ()=>{ pm.expect(d).to.have.property(\"balance\"); pm.expect(d).to.have.property(\"currency\"); }); }"], "type": "text/javascript" } }] },
        { "name": "GET 余额查询 - 404", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/accounts/99999999/balance" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 404\", () => pm.response.to.have.status(404));"], "type": "text/javascript" } }] }
      ]
    },
    {
      "name": "Customers",
      "item": [
        { "name": "POST 客户注册 - 成功", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"name\":\"测试客户\",\"idCard\":\"110101199001011234\",\"phone\":\"13800138000\",\"email\":\"test@example.com\"}" }, "url": "{{core_bank_base_url}}/api/v1/customers" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 201\", () => pm.response.to.have.status(201));", "const j=pm.response.json(); const d=j.data||j; if(d.customerId)pm.environment.set(\"customer_id\",d.customerId);"], "type": "text/javascript" } }] },
        { "name": "POST 客户注册 - 400 缺 name", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"idCard\":\"110101199001011234\"}" }, "url": "{{core_bank_base_url}}/api/v1/customers" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 400 or 500\", () => pm.expect([400,500]).to.include(pm.response.code));"], "type": "text/javascript" } }] },
        { "name": "GET 客户查询", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/customers/{{customer_id}}" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 404\", () => pm.expect([200,404]).to.include(pm.response.code));", "if(pm.response.code===200) pm.test(\"has name\", ()=>{ const d=pm.response.json().data||pm.response.json(); pm.expect(d).to.have.property(\"name\"); });"], "type": "text/javascript" } }] },
        { "name": "GET 客户查询 - 404", "request": { "method": "GET", "url": "{{core_bank_base_url}}/api/v1/customers/99999999" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 404\", () => pm.response.to.have.status(404));"], "type": "text/javascript" } }] },
        { "name": "PUT 客户更新", "request": { "method": "PUT", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"phone\":\"13900139000\"}" }, "url": "{{core_bank_base_url}}/api/v1/customers/{{customer_id}}" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 404\", () => pm.expect([200,404]).to.include(pm.response.code));"], "type": "text/javascript" } }] }
      ]
    },
    {
      "name": "Transactions",
      "item": [
        { "name": "GET 交易查询 - 分页", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/transactions?page=1&pageSize=10", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","transactions"], "query": [{"key":"page","value":"1"},{"key":"pageSize","value":"10"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200\", () => pm.response.to.have.status(200));", "const j=pm.response.json(); const d=j.data||j; pm.expect(d).to.satisfy(v=>v.items!==undefined||Array.isArray(v));"], "type": "text/javascript" } }] },
        { "name": "GET 交易查询 - 按 accountId", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/transactions?accountId={{account_id}}&page=1&pageSize=5", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","transactions"], "query": [{"key":"accountId","value":"{{account_id}}"},{"key":"page","value":"1"},{"key":"pageSize","value":"5"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200\", () => pm.response.to.have.status(200));"], "type": "text/javascript" } }] },
        { "name": "GET 交易历史", "request": { "method": "GET", "url": { "raw": "{{core_bank_base_url}}/api/v1/transactions/history?accountId={{account_id}}&page=1&pageSize=10", "host": ["{{core_bank_base_url}}"], "path": ["api","v1","transactions","history"], "query": [{"key":"accountId","value":"{{account_id}}"},{"key":"page","value":"1"},{"key":"pageSize","value":"10"}] } }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 400\", () => pm.expect([200,400]).to.include(pm.response.code));"], "type": "text/javascript" } }] },
        { "name": "POST 行内转账 - 成功", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"fromAccountId\":{{account_id}},\"toAccountId\":{{to_account_id}},\"amount\":0.01,\"remark\":\"e2e\"}" }, "url": "{{core_bank_base_url}}/api/v1/transactions/transfer" }, "event": [{ "listen": "prerequest", "script": { "exec": ["var to=pm.environment.get(\"to_account_id\"); if(!to){ var from=parseInt(pm.environment.get(\"account_id\")||1,10); pm.environment.set(\"to_account_id\", from+1); }"], "type": "text/javascript" } }, { "listen": "test", "script": { "exec": ["pm.test(\"Status 200 or 400 or 403 or 404\", () => pm.expect([200,400,403,404]).to.include(pm.response.code));", "if(pm.response.code===200){ const d=pm.response.json().data||pm.response.json(); pm.test(\"has transactionId\", ()=>pm.expect(d).to.have.property(\"transactionId\")); }"], "type": "text/javascript" } }] },
        { "name": "POST 行内转账 - 400 同账户", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"fromAccountId\":{{account_id}},\"toAccountId\":{{account_id}},\"amount\":1}" }, "url": "{{core_bank_base_url}}/api/v1/transactions/transfer" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 400 or 200\", () => pm.expect([200,400]).to.include(pm.response.code));"], "type": "text/javascript" } }] },
        { "name": "POST 支付扣款 - 成功", "request": { "method": "POST", "header": [{"key":"Content-Type","value":"application/json"}], "body": { "mode": "raw", "raw": "{\"accountId\":{{account_id}},\"amount\":0.01,\"refId\":\"e2e-debit-ref-1\",\"remark\":\"e2e debit\"}" }, "url": "{{core_bank_base_url}}/api/v1/transactions/debit" }, "event": [{ "listen": "test", "script": { "exec": ["pm.test(\"Status 201 or 400 or 404\", () => pm.expect([201,400,404]).to.include(pm.response.code));", "if(pm.response.code===201){ const d=pm.response.json().data||pm.response.json(); pm.test(\"has transactionId\", ()=>pm.expect(d).to.have.property(\"transactionId\")); }"], "type": "text/javascript" } }] }
      ]
    }
  ]
}
